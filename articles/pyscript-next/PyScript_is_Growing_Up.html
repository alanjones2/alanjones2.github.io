<!DOCTYPE html>
<html lang="en">

<head>
    <title>PyScript Evolves: How the New Version Stacks Up</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:image" content="./images/pretty-app.png">
    <meta name="twitter:image:src" content="./images/pretty-app.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="article:author" content="https://alanjones2.github.io">
    <meta name="twitter:creator" content="@MrAlanJones">
    <meta name="author" content="Alan Jones">


    <meta content="We build a data viz app with the new faster PyScript">
    <meta content="https://alanjones2.github.io" property="og:url">
    <meta content="PyScript is Growing Up" property="og:title">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script>hljs.highlightAll();</script>


    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VDYY6RYRK1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-VDYY6RYRK1');
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
        crossorigin="anonymous"></script>

    <style>
        blockquote {
            font-style: italic;
            padding-left: 2em;
        }

        img {
            max-width: 100%;
            padding-bottom: 4px;
            padding-top: 4px;
        }
    </style>
</head>

<body class=" bg-white">
    <script>fetch("https://alanjones.pythonanywhere.com/lg?url=alanjones2.github.io/articles/PyScript is Growing Up")
            .then(data => console.log(data));
    </script>
    <a href="https://alanjones2.github.io" style="text-decoration:none">
        <div class="p-2 mb-2 bg-secondary text-white">
            <h1 class="display-6" style="font-weight:bolder">Alan<span style="font-weight:lighter">Jones</span>
                <span class="text-white" style="font-size:50%;font-weight: lighter;"> Coding, Data Science and
                    Data Visualization</span>
            </h1>
        </div>
    </a>

    <div style="margin-top:30px" class="container">

        <div class="row bg-white" style="width: 100%;">
            <!-- content-->
            <h1 class="display-4 fw-bold">PyScript Evolves: How the New Version Stacks Up</h1>
            <h2 class="lead p-2" style="font-size:xx-large;">We build a data viz app with the new faster PyScript</h2>
            <div><img alt="" src="./images/pretty-app.png">
            </div>

            <h3>According to pyscript.org:</h3>
<blockquote>
<p>If the web and Python had a baby, you'd get PyScript.</p>
</blockquote>
<p>While I'm not sure that is a concept that I want to engage with, I get the point. PyScript combines two of the most important global technologies, the web and Python. Only time will tell how important it turns out to be but, if nothing else, it's a pretty cool technology.</p>
<p>PyScript was built on top of the Pyodide Python interpreter which is a port of CPython to WASM the web assembly language that can run in a browser. This means that you can execute Python programs, natively, in the browser - no translating to Javascript is required.</p>
<p>Does this signal the end of JavaScript? </p>
<p>No, it doesn't. PyScript sits alongside JavaScript and communicates with it; JavaScript remains an essential part of the browser ecosystem.</p>
<h3>PyScript Next</h3>
<p>PyScript has been around for barely a couple of years but it has already undergone a major re-write, dubbed in some quarters 'PyScript Next'. In the new version, you have a choice of interpreters: the original Pyodide interpreter and now a MicroPython interpreter, too. </p>
<p>One of the drawbacks of PyScript has been the fairly lengthy load time but now, according to <a href="https://jeff.glass/">Jeff Glass</a>, the blogger and a maintainer of PyScript, the new version using Pyodide loads significantly quicker than the original and, when using the much smaller footprint MicroPython, loads in only 4% of the time.</p>
<p>Small also means less capable, though. MicroPython was designed to run on micro-controllers and does not include the full set of standard libraries, let alone access to the vast number of packages available on PyPi. Pyodide, on the other hand, has several packages built in and can load pure Python packages from PyPi.</p>
<h3>Can we have some code, please</h3>
<p>Yes, of course, I was just getting around to it.</p>
<p>First, we're going to write a bare-bones PyScript app just to get a pattern in our heads of how a PyScript app is constructed (it's quite simple). Then we'll develop a data visualisation app that imports external data and uses Python libraries to produce an engaging web page that can be deployed on any server.</p>
<p>There are a few options when constructing a PyScript app but we are going to use the recommended method which requires the use of three files: an HTML file, a configuration file and a file that contains the Python scripts.</p>
<p><em>And here is a warning: the new version of PyScript is not completely compatible with the previous versions. So, if you've followed any of my previous tutorials about PyScript, please pretend that you didn't. I'm not going to detail the differences; we'll just build an app with the new version - you'll see that it is not so very different.</em></p>
<p>The easiest way to get started is to sign up for an account on <em>pyscript.com</em>. This is an online IDE that lets you code run and publish PyScript apps for free.</p>
<p>If you do that and click on the little plus sign on the left of the dashboard, it will set up a new project for you with three default files.</p>
<p>The files are <em>index.html</em>, <em>main.py</em> and <em>pyscript.toml</em>. (If you want to run through this on your local machine, rather than <em>pyscript.com</em> then you can copy the files from the listings below - put them all in the same folder)</p>
<p>These are the three files that I mentioned earlier and we'll go through them one by one.</p>
<h3><em>index.html</em></h3>
<p>Yes, I'm sorry, but you do have to know a bit of HTML. It's not so difficult, though. The HTML file that will be generated by <em>pyscript.com</em> will look soemthing like this:</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Still King&lt;/title&gt;

    &lt;!-- Recommended meta tags --&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot;&gt;

    &lt;!-- PyScript CSS --&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://pyscript.net/releases/2024.3.1/core.css&quot;&gt;

    &lt;!-- This script tag bootstraps PyScript --&gt;
    &lt;script type=&quot;module&quot; src=&quot;https://pyscript.net/releases/2024.3.1/core.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script type=&quot;py&quot; src=&quot;./main.py&quot; config=&quot;./pyscript.toml&quot; terminal&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This is a pretty basic web page: <code>&lt;!DOCTYPE html&gt;</code> tells the browser that this is an HTML5 file; the rest of the file is contained in a pair of <code>&lt;html&gt;</code>tags and the language is set to be English;  within those tags are a pair of <code>&lt;head&gt;</code>tags and a pair of <code>&lt;body&gt;</code>tags.</p>
<p>Inside the <em>head</em> there are recommended meta tags that will ensure that the file is correctly rendered on a range of devices. Following that we import the PyScript CSS file and the PyScript JavaScript file from <em>pyscript.net</em>. Note that the particular releases of the files are specified (here it is version 2024.3.1) - in previous versions you were able to specify the 'latest' version but this is now deprecated. Loading the latest version was always a dodgy idea, I think, because any changes to a new version could potentially break your app.</p>
<p>In the <em>body</em> tag is a <code>&lt;script&gt;</code> tag that  has the following attributes:</p>
<ul>
<li>
<p><code>type="py"</code> - this means that the Pyodide interpreter will be used. For Micropython the type needs to be "mpy".</p>
</li>
<li>
<p><code>src="./main.py"</code>- this is the location and name of the Python script.</p>
</li>
<li>
<p><code>config="./pyscript.toml"</code> - this is the configuration file that can be either in TOML or JSON format - here we are using TOML.</p>
</li>
<li>
<p><code>terminal</code>- this tells PyScript that there should be a terminal window on the web page (it's here that the perennial phrase "Hello World" will be written).</p>
</li>
</ul>
<h3><em>pyscript.toml</em></h3>
<p>The purpose of this file is to set the configuration for the app. It is here that external files and libraries should be declared. In this app there is no configuration to speak of and it only contains the name of the app:</p>
<pre><code class="language-toml">name = &quot;Still King&quot;
</code></pre>
<h3><em>main.py</em></h3>
<p>Here is where the Python code resides and later we will see a rather more complex chunk of code. But for now <em>main.py</em> simply contains:</p>
<pre><code class="language-python">print(&quot;Hello, World!&quot;)
</code></pre>
<p>Now, that was a surprise, wasn't it?</p>
<p>The <code>print</code>statement is standard Python and its output is to the terminal (which we've placed on the web page). So, when you load the page you will simply get a message written into a black panel on an otherwise blank webpage.</p>
<h3>Running the app</h3>
<p>If you are using <em>pyscript.com</em>, then simply hit the <em>run</em> button and the webpage will be rendered in a <em>preview</em> panel.</p>
<p><img alt="" src="images/Screenshot-pyscript-com.png" /> </p>
<p>If you are working locally, then you need to start up a local web server ( just double-clicking on the web page will not load the other files due to CORS restrictions). So, open a command window, navigate to your working directory and type:</p>
<pre><code class="language-bash">python -m http.server
</code></pre>
<p>This will start a server so, in your browser, open "localhost:8000". This should automatically open "index.html" and thus run the app. If for some reason this doesn't happen (maybe you called your file something else), you should see a directory listing of your folder - click on the HTML file to run it.</p>
<p>You can find the app on <em>pyscript.com</em> here: <a href="https://alan_jones.pyscriptapps.com/still-king/latest/">Still King</a> - click in the bottom right of the screen to see the code. (You've probably guessed that <em>pyscript.com</em> chooses the name of the application - you can, of course, change it.)</p>
<h3>The Data Viz App</h3>
<p>OK, one step at a time. Before we can visualise it, we need some data. I'm going to use a dataset that tracks Global CO2 emissions over time - you can download it here: <a href="https://raw.githubusercontent.com/alanjones2/CO2/master/data/world_df.csv">CO2 Data</a> (also see <em>Notes</em>, below). Put it into the same folder as the code. You can see what it looks like in the image below.</p>
<p><img alt="" src="images/datatable.png" /></p>
<p>It is a subset of a larger dataset that includes many countries and areas of the World. This file contains data for the World as a whole, so the first two columns are somewhat redundant. To find out more about the data see the Notes, below.</p>
<p>PyScript cannot access the local file system but it maintains a virtual file system that resides in the browser (well, to be accurate it is Pyodide that does this). So, in order to have access to the data we need PyScript to copy the file into the virtual file system when it loads the page.</p>
<p>To achieve this, we need an addition to the <em>pyscript.conf</em> file. Add the following code to that file.</p>
<pre><code class="language-toml">[files]
&quot;world_df.csv&quot; = &quot;./world_df.csv&quot;
</code></pre>
<p>This 'files' section tells PyScript to copy the file "world_df.csv" into a file of the same name in the virtual file system when the page loads. Now, when the app has started the CSV file can be accessed by Python code in the conventional way. For example, we will load the data into a Pandas dataframe like this:</p>
<pre><code class="language-python">df = pd.read_csv('./world_df.csv')
</code></pre>
<p>We are going to use Plotly to draw a chart on our web page and while we will create this in Python, getting it on to a webpage usually means writing a bit of JavaScript to render the chart. </p>
<p>However,  to my very pleasant surprise, it seems that one of the types of content that PyScript handles automatically is Plotly figures (this wasn't the case in previous versions). </p>
<p>Let me explain.</p>
<p>PyScript uses a method <code>display</code>to put content into a container on the web page. The following Python code displays the content of the variable <code>header</code> in a container on the web page with the id 'header'.  </p>
<pre><code class="language-python">display(header, target=&quot;header&quot;)
</code></pre>
<p>The content of the variable <code>header</code>could be text (and in our program it is) but <code>display</code>can also deal with more complex such as a Matplotlib figure - PyScript takes care of how the content is rendered.</p>
<p>In previous versions that more complex content did not include Plotly figures but now it does. So if we construct a Plotly figure in Python in the variable <code>fig</code>we can simply write</p>
<pre><code class="language-python">display(fig, target=&quot;graph&quot;)
</code></pre>
<p>in order to render that figure on the webpage. Excellent!</p>
<p>So, let's do that.</p>
<p>Here is a the web page that we are going to use.</p>
<h3><em>viz0.html</em></h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;title&gt;Plotly Viz0&lt;/title&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1.0&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://pyscript.net/releases/2024.3.2/core.css&quot;&gt;
    &lt;script type=&quot;module&quot; src=&quot;https://pyscript.net/releases/2024.3.2/core.js&quot;&gt;&lt;/script&gt;

    &lt;!-- Plotly JS library--&gt;
    &lt;script src='https://cdn.plot.ly/plotly-latest.min.js' crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;script type=&quot;py&quot; src=&quot;./viz1.py&quot; config=&quot;./viz1.toml&quot;&gt;&lt;/script&gt;

    &lt;!-- Header and subheader --&gt;
    &lt;h1 id=&quot;header&quot;&gt;&lt;/h1&gt;
    &lt;h2 id=&quot;subheader&quot;&gt;&lt;/h2&gt;

    &lt;!-- This is where the chart will be displayed --&gt;
    &lt;div id=&quot;chart1&quot;&gt;&lt;/div&gt;

    &lt;!-- The description tag is here --&gt;
    &lt;div id=&quot;description&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The <code>&lt;head&gt;</code>part is pretty much identical to the one we already seen. The differences are the title and the inclusion of the Plotly Javascript library - we won't be using this explicitly but it must still be imported.</p>
<p>The <code>&lt;body&gt;</code>contains the same <code>&lt;script&gt;</code>tag that we saw before but with different names for the files.</p>
<p>Following this there are three areas, the header and subheader, which will contain text, a <code>&lt;div&gt;</code>tag that will hold the chart and, finally, another <code>&lt;div&gt;</code>tag that will hold some decriptive text.</p>
<p>It is important to note that each tag is given a unique id - this will be used to identify it in the Python code.</p>
<p>I hope that you can see that this is a very simple template that could be used for a number of different purposes.</p>
<p>Now let's look at the configuration.</p>
<h3><em>viz1.toml</em></h3>
<pre><code class="language-toml">packages = [&quot;pandas&quot;,&quot;plotly&quot;]

[files]
&quot;world_df.csv&quot; = &quot;./world_df.csv&quot;
</code></pre>
<p>Here we've set the packages that we will use and the file that must be loaded. Each of these will be loaded at startup.</p>
<p>Now for the main logic of the app.</p>
<h3>_ viz1.py_</h3>
<p>This is completely standard Python. We import the libraries that we need and this must include <code>display</code>from the built-in <code>pyscipt</code>library. </p>
<p>We then assign some variables with text that correspond to the headers and description that we saw earlier and we use the <code>display</code>method to place then in the appropraie <code>&lt;div&gt;</code>tags in the webpage.</p>
<p>Next, we read the data into a Pandas dataframe and then create a Plotly figure - a line chart - and we display that in the <code>&lt;div&gt;</code>called "chart1".</p>
<pre><code class="language-python"># Import libraries
import pandas as pd
import plotly.express as px
from pyscript import display

header = &quot;&quot;&quot;World CO2 Emissions over Time&quot;&quot;&quot;
subheader = &quot;CO2 Emissions tracked over the period 1850 to 2020&quot;
description = &quot;&quot;&quot;The graph shows the annual emissions of Carbon Dioxide, 
in tonnes, emitted globally
&quot;&quot;&quot;
display(header, target=&quot;header&quot;)
display(subheader, target=&quot;subheader&quot;)
display(description, target=&quot;description&quot;)

df = pd.read_csv('./world_df.csv')

fig = px.line(df, x=&quot;Year&quot;, y='Annual CO₂ emissions',
              width=800, height=400,
              template=&quot;plotly_white&quot;)

display(fig, target=&quot;chart1&quot;)
</code></pre>
<p>The result is a web page that displays the chart ans the text around it. We could, of course, change the text and the chart in the Python code to produce an entirely different webpage without having to chage the HTML at all.</p>
<p>Why have I call two of the files 'viz1' when the HTML is called 'viz0'? Because there is also a 'viz1.html' which includes the Bootstrap user interface library and produces a rather prettier page.</p>
<p><img alt="" src="images/pretty-app.png" /></p>
<p>You can see the resulting, prettier, web page here: <a href="https://alan_jones.pyscriptapps.com/ploty-viz1/latest/">Hidden Cherry</a>.</p>
<p>If you look in my GitHub repo (see Notes, below), you will find both versions.</p>
<h3>But it is still a bit slow to load</h3>
<p>I hope you will agree that using PyScript is a fairly simple way of creating a data visualistion web app. There is one bugbear: as you will already know if you've tried out the apps, and despite Jeff Glass's comments, it is still rather slow to load the page. </p>
<p>However, that is a one-off occurrence at startup due to having to load the rather bulky PyScript library. After the initial load, a PyScript app reacts as quickly as any other webpage. If, for example, we were to create an interactive app that changed the the chart in response to some user input, we would find that it responds as quickly as any other web page.</p>
<hr />
<p>Thanks for reading, I hope this has been useful. Also, I would reiterate that PyScript tutorials like this that target versions before the end of 2023 are now very likely to be out of date.</p>
<p>If you like this type of article, then please consider subscribing to my occasional, and free, <a href="technofile.susbstack.com">newsletter</a> where I post links to articles about Data Visualisation, Data Science, AI and other Python-related stuff.</p>
<p>For links to code and data, see the Notes, below.</p>
<h3>Notes</h3>
<ul>
<li>
<p><a href="https://raw.githubusercontent.com/alanjones2/CO2/master/data/world_df.csv">CO2 Data</a> can be downloaded from my GitHub repo using the link, it is derived from the <a href="https://github.com/owid/co2-data">Our World in Data (OWID) co2-data GitHub repository</a>, <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons BY license</a></p>
</li>
<li>
<p>You can find the code and data in my <a href="[Alan-Jones-article-code/pyscript-next at master · alanjones2/Alan-Jones-article-code · GitHub](https://github.com/alanjones2/Alan-Jones-article-code/tree/master/pyscript-next)">GitHub repo</a></p>
</li>
<li>
<p>All images, screenshots, etc. are by me, the author, unless otherwise indicated.</p>
</li>
<li>
<p><em>Disclaimer: I have no affiliation with Anaconda, PyScript.com_or PyScript.net.</em></p>
</li>
</ul>
        </div>
        <div class="col-sm-3 p-2">
            <!ads etc here -->
                <script async
                    src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
                    crossorigin="anonymous"></script>
                <!-- sfs vertical -->

                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959"
                    data-ad-slot="6617299104" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>

                <!-- sfs vertical -->

                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959"
                    data-ad-slot="6617299104" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <!-- sfs vertical -->

                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959"
                    data-ad-slot="6617299104" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
                <!-- sfs vertical -->

                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959"
                    data-ad-slot="6617299104" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>


                <div id="amzn-assoc-ad-d5bf4dcd-55c6-4038-a3d8-ff8bfa49de8a"></div>
                <script async
                    src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=d5bf4dcd-55c6-4038-a3d8-ff8bfa49de8a"></script>

        </div>

    </div>


    <div style="margin: 20px;">
        <script async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3208991186670959"
            crossorigin="anonymous"></script>
        <!-- alanjonescoding_ads_AdSense1_1x1_as -->
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3208991186670959"
            data-ad-slot="2622033521" data-ad-format="auto" data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        <footer class="text-right text-secondary">
            <i>Please note that all the software in these articles is written for educational purposes and should
                not be
                considered suitable for production code</i>
            <br />
            <i>This site may contain affliate links. If you purchase an item through such a link I may get a
                commision
                but at no cost to you. As an Amazon Associate, I earn from qualifying purchases.</i>
            <br />
            <i>&copy; 2024, Alan Jones</i> &nbsp;

        </footer>
    </div>
    </div>

</body>

</html>